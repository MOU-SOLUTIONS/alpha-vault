<!--
  Alpha Vault Financial System
  
  @author Mohamed Dhaoui
  @component LoginComponent
  @description Secure user authentication interface
-->

<div class="login-container">
  
  <!-- Header Section -->
  <header class="login-header">
    <h1 class="login-title">Welcome Back</h1>
    <p class="login-subtitle">Sign in to your Alpha Vault account</p>
  </header>

  <!-- Login Form -->
  <form 
    [formGroup]="loginForm" 
    (ngSubmit)="onSubmit()" 
    class="login-form" 
    novalidate 
    [attr.aria-busy]="isSubmitting || isRateLimited"
    role="form"
    aria-label="Login form"
    itemscope
    itemtype="https://schema.org/LoginAction"
  >
    
    <!-- Email Field -->
    <div class="form-group">
      <label for="email" class="form-label">Email Address</label>
      <div class="input-wrapper">
        <i class="fas fa-envelope input-icon" aria-hidden="true"></i>
        <input
          id="email"
          name="email"
          type="email"
          formControlName="email"
          class="form-input"
          placeholder="Enter your email"
          inputmode="email"
          enterkeyhint="next"
          spellcheck="false"
          autocapitalize="none"
          autocomplete="username"
          minlength="5"
          maxlength="254"
          [class.error]="isFieldInvalid('email')"
          [attr.aria-invalid]="isFieldInvalid('email')"
          [attr.aria-describedby]="isFieldInvalid('email') ? 'email-error' : null"
          [readOnly]="isSubmitting || isRateLimited"
          required
          aria-required="true"
        />
      </div>
      <div 
        id="email-error" 
        class="error-message" 
        *ngIf="isFieldInvalid('email')"
        role="alert"
        aria-live="polite"
      >
        <span *ngIf="loginForm.get('email')?.errors?.['required']">
          Email is required
        </span>
        <span *ngIf="loginForm.get('email')?.errors?.['email']">
          Please enter a valid email
        </span>
      </div>
    </div>

    <!-- Password Field -->
    <div class="form-group">
      <label for="password" class="form-label">Password</label>
      <div class="input-wrapper">
        <i class="fas fa-lock input-icon" aria-hidden="true"></i>
        <input
          id="password"
          name="password"
          [type]="showPassword ? 'text' : 'password'"
          formControlName="password"
          class="form-input"
          placeholder="Enter your password"
          autocomplete="current-password"
          minlength="8"
          maxlength="128"
          [class.error]="isFieldInvalid('password')"
          [attr.aria-invalid]="isFieldInvalid('password')"
          [attr.aria-describedby]="isFieldInvalid('password') ? 'password-error' : null"
          [readOnly]="isSubmitting || isRateLimited"
          required
          aria-required="true"
        />
        <button
          type="button"
          class="password-toggle"
          (click)="togglePasswordVisibility()"
          [attr.aria-pressed]="showPassword"
          [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'"
          tabindex="0"
        >
          <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
        </button>
      </div>
      <div 
        id="password-error" 
        class="error-message" 
        *ngIf="isFieldInvalid('password')"
        role="alert"
        aria-live="polite"
      >
        <span *ngIf="loginForm.get('password')?.errors?.['required']">
          Password is required
        </span>
        <span *ngIf="loginForm.get('password')?.errors?.['minlength']">
          Password must be at least 8 characters
        </span>
      </div>
    </div>

    <!-- Form Options -->
    <div class="form-options">
      <label class="checkbox-wrapper">
        <input 
          type="checkbox" 
          formControlName="rememberMe" 
          class="checkbox-input"
          aria-describedby="remember-me-description"
        >
        <span class="checkbox-custom" aria-hidden="true"></span>
        <span class="checkbox-label">Remember me</span>
        <span id="remember-me-description" class="sr-only">
          Keep me signed in on this device
        </span>
      </label>
      <button 
        type="button" 
        class="forgot-link" 
        (click)="showForgotPassword()"
        aria-label="Forgot password? Click to reset your password"
      >
        Forgot password?
      </button>
    </div>

    <!-- Submit Button -->
    <button
      type="submit"
      class="submit-button"
      [disabled]="isSubmitting || isRateLimited"
      [class.loading]="isSubmitting"
      [attr.aria-label]="getSubmitButtonLabel()"
    >
      <span class="button-text" *ngIf="!isSubmitting && !isRateLimited">
        Sign In
      </span>
      <span class="button-text" *ngIf="isSubmitting">
        Signing In...
      </span>
      <span class="button-text" *ngIf="isRateLimited">
        Rate limited ({{ rateLimitCountdown }}s)
      </span>
      <div class="spinner" *ngIf="isSubmitting" aria-hidden="true"></div>
    </button>

    <!-- Error Banner -->
    <div 
      class="error-banner" 
      *ngIf="loginError" 
      role="alert" 
      tabindex="-1" 
      #loginErr
      aria-live="assertive"
    >
      <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
      <span>{{ loginError }}</span>
    </div>
  </form>

  <!-- Signup Section -->
  <section class="signup-section">
    <p class="signup-text">Don't have an account?</p>
    <button 
      type="button" 
      class="signup-button" 
      (click)="navigateToSignup()"
      aria-label="Create a new Alpha Vault account"
    >
      Create Account
    </button>
  </section>
</div>

<!-- Screen Reader Only Content -->
<div class="sr-only" aria-live="polite" aria-atomic="true">
  <span *ngIf="isSubmitting">Form is submitting, please wait</span>
  <span *ngIf="isRateLimited">Rate limited, please wait {{ rateLimitCountdown }} seconds</span>
  <span *ngIf="loginError">Error: {{ loginError }}</span>
</div>
