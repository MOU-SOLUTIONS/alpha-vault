<!-- ================================================================
              Coded by Mohamed Dhaoui for Alpha Vault
================================================================ -->

<section class="row justify-content-center g-2 h-100" role="region" aria-labelledby="sourceChartTitle">
  <div class="col-12 h-100">
    <div class="source-chart-box d-flex flex-column h-100">
      <header class="source-chart-header">
        <h3 id="sourceChartTitle" class="source-chart-title">Income by Source</h3>
        <div class="source-chart-badge">This Month</div>
      </header>

      <div class="source-chart-content flex-grow-1" [class.loading]="isLoading">
        <ng-container *ngIf="!hasData && !isLoading; else showChart">
          <div class="no-data-message">
            <div class="no-data-icon">ðŸ“ˆ</div>
            <p>No source data available</p>
            <p class="no-data-hint">Add some incomes to see this chart</p>
          </div>
        </ng-container>

        <ng-template #showChart>
          <div class="source-chart-wrapper">
            <canvas
              baseChart
              [data]="pieChartData"
              [labels]="pieChartLabels"
              [type]="'pie'"
              [options]="pieChartOptions"
              class="source-chart-canvas"
              role="img"
              aria-label="Income distribution by source"
            ></canvas>
          </div>

          <div class="legend-container">
            <div *ngFor="let label of pieChartLabels; let i = index" class="legend-item">
              <div class="legend-color" [style.background-color]="getBackgroundColor(i)"></div>
              <div class="legend-label">{{ label }}</div>
              <div class="legend-value">{{ getValueForLabel(label) | currency }}</div>
            </div>
          </div>
        </ng-template>

        <div *ngIf="isLoading" class="chart-loader">
          <div class="loader-spinner"></div>
        </div>
      </div>
    </div>
  </div>
</section>