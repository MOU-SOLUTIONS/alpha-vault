<!--
  Alpha Vault Financial System
  
  @author Mohamed Dhaoui
  @component PasswordResetComponent
  @description Secure password recovery template with email validation
-->

<div class="password-reset-container" itemscope itemtype="https://schema.org/WebPage">
  <!-- Header Section -->
  <div class="reset-header">
    <h1 class="reset-title" itemprop="name">Reset Your Password</h1>
    <p class="reset-subtitle" itemprop="description">Secure password recovery for your Alpha Vault account</p>
  </div>

  <!-- Forgot Password Form -->
  <form 
    *ngIf="currentStep === 'forgot'" 
    [formGroup]="forgotPasswordForm" 
    (ngSubmit)="onSubmitForgotPassword()" 
    [attr.aria-busy]="isSubmitting" 
    class="reset-form"
    role="form"
    aria-labelledby="forgot-title"
  >
    <div class="phase-header">
      <h2 id="forgot-title" class="phase-title">Forgot Password</h2>
      <p class="phase-description">Enter your email to receive a reset link</p>
    </div>

    <div class="form-group">
      <label for="email" class="form-label">Email Address</label>
      <div class="input-wrapper">
        <i class="fas fa-envelope input-icon" aria-hidden="true"></i>
        <input
          id="email"
          type="email"
          formControlName="email"
          class="form-input"
          placeholder="Enter your email address"
          autocomplete="email"
          [class.error]="isFieldInvalid('email', forgotPasswordForm)"
          [attr.aria-invalid]="isFieldInvalid('email', forgotPasswordForm)"
          [attr.aria-describedby]="isFieldInvalid('email', forgotPasswordForm) ? 'email-error' : null"
          required
        />
      </div>
      <div 
        id="email-error" 
        class="error-message" 
        *ngIf="isFieldInvalid('email', forgotPasswordForm)"
        role="alert"
        aria-live="polite"
      >
        <span *ngIf="forgotPasswordForm.get('email')?.errors?.['required']">
          Email is required
        </span>
        <span *ngIf="forgotPasswordForm.get('email')?.errors?.['email']">
          Please enter a valid email address
        </span>
      </div>
    </div>

    <div class="form-actions">
      <button 
        type="submit" 
        class="submit-button" 
        [class.loading]="isSubmitting"
        [attr.aria-label]="isSubmitting ? 'Sending reset email...' : 'Send reset email'"
      >
        <span class="button-text" *ngIf="!isSubmitting">Send Reset Link</span>
        <span class="button-text" *ngIf="isSubmitting">Sending...</span>
        <div class="spinner" *ngIf="isSubmitting" role="status" aria-live="polite" aria-label="Submitting..."></div>
      </button>
    </div>

    <!-- Success Message -->
    <div 
      class="success-banner" 
      *ngIf="successMessage" 
      role="status" 
      aria-live="polite"
    >
      <i class="fas fa-check-circle" aria-hidden="true"></i>
      <span>{{ successMessage }}</span>
    </div>

    <!-- Error Message -->
    <div 
      class="error-banner" 
      *ngIf="resetError" 
      role="alert" 
      aria-live="assertive"
    >
      <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
      <span>{{ resetError }}</span>
    </div>
  </form>

  <!-- Reset Password Form -->
  <form 
    *ngIf="currentStep === 'reset'" 
    [formGroup]="resetPasswordForm" 
    (ngSubmit)="onSubmitResetPassword()" 
    [attr.aria-busy]="isSubmitting" 
    class="reset-form"
    role="form"
    aria-labelledby="reset-title"
  >
    <div class="phase-header">
      <h2 id="reset-title" class="phase-title">Set New Password</h2>
      <p class="phase-description">Create a strong password for your account</p>
    </div>

    <div class="form-group">
      <label for="newPassword" class="form-label">New Password</label>
      <div class="input-wrapper">
        <i class="fas fa-lock input-icon" aria-hidden="true"></i>
        <input
          id="newPassword"
          [type]="showPassword ? 'text' : 'password'"
          formControlName="newPassword"
          class="form-input"
          placeholder="Enter your new password"
          autocomplete="new-password"
          minlength="8"
          maxlength="128"
          [class.error]="isFieldInvalid('newPassword', resetPasswordForm)"
          [attr.aria-invalid]="isFieldInvalid('newPassword', resetPasswordForm)"
          [attr.aria-describedby]="isFieldInvalid('newPassword', resetPasswordForm) ? 'newPassword-error' : null"
          required
        />
        <button
          type="button"
          class="password-toggle"
          (click)="togglePasswordVisibility()"
          [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'"
        >
          <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
        </button>
      </div>
      
      <div 
        id="newPassword-error" 
        class="error-message" 
        *ngIf="isFieldInvalid('newPassword', resetPasswordForm)"
        role="alert"
        aria-live="polite"
      >
        <span *ngIf="resetPasswordForm.get('newPassword')?.errors?.['required']">
          New password is required
        </span>
        <span *ngIf="resetPasswordForm.get('newPassword')?.errors?.['minlength']">
          Password must be at least 8 characters
        </span>
        <span *ngIf="resetPasswordForm.get('newPassword')?.errors?.['maxlength']">
          Password must be less than 128 characters
        </span>
      </div>
    </div>

    <div class="form-group">
      <label for="confirmPassword" class="form-label">Confirm New Password</label>
      <div class="input-wrapper">
        <i class="fas fa-lock input-icon" aria-hidden="true"></i>
        <input
          id="confirmPassword"
          [type]="showConfirmPassword ? 'text' : 'password'"
          formControlName="confirmPassword"
          class="form-input"
          placeholder="Confirm your new password"
          autocomplete="new-password"
          minlength="8"
          maxlength="128"
          [class.error]="isFieldInvalid('confirmPassword', resetPasswordForm)"
          [attr.aria-invalid]="isFieldInvalid('confirmPassword', resetPasswordForm)"
          [attr.aria-describedby]="isFieldInvalid('confirmPassword', resetPasswordForm) ? 'confirmPassword-error' : null"
          required
        />
        <button
          type="button"
          class="password-toggle"
          (click)="toggleConfirmPasswordVisibility()"
          [attr.aria-label]="showConfirmPassword ? 'Hide password' : 'Show password'"
        >
          <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
        </button>
      </div>
      <div 
        id="confirmPassword-error" 
        class="error-message" 
        *ngIf="isFieldInvalid('confirmPassword', resetPasswordForm)"
        role="alert"
        aria-live="polite"
      >
        <span *ngIf="resetPasswordForm.get('confirmPassword')?.errors?.['required']">
          Please confirm your password
        </span>
      </div>
    </div>

    <div class="form-actions">
      <button 
        type="button" 
        class="back-button" 
        (click)="goBackToForgot()"
      >
        <i class="fas fa-arrow-left" aria-hidden="true"></i>
        Back
      </button>
      <button 
        type="submit" 
        class="submit-button" 
        [class.loading]="isSubmitting"
        [attr.aria-label]="isSubmitting ? 'Resetting password...' : 'Reset password'"
      >
        <span class="button-text" *ngIf="!isSubmitting">Reset Password</span>
        <span class="button-text" *ngIf="isSubmitting">Resetting...</span>
        <div class="spinner" *ngIf="isSubmitting" role="status" aria-live="polite" aria-label="Submitting..."></div>
      </button>
    </div>

    <!-- Success Message -->
    <div 
      class="success-banner" 
      *ngIf="successMessage" 
      role="status" 
      aria-live="polite"
    >
      <i class="fas fa-check-circle" aria-hidden="true"></i>
      <span>{{ successMessage }}</span>
    </div>

    <!-- Error Message -->
    <div 
      class="error-banner" 
      *ngIf="resetError" 
      role="alert"
      aria-live="assertive"
    >
      <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
      <span>{{ resetError }}</span>
    </div>
  </form>

  <!-- Login Link -->
  <div class="login-section">
    <p class="login-text">Remember your password?</p>
    <button type="button" class="login-button" (click)="navigateToLogin()">
      Sign In
    </button>
  </div>
</div>

<!-- Structured Data for SEO -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Password Reset - Alpha Vault",
  "description": "Reset your Alpha Vault password securely",
  "url": "https://alphavault.com/auth/password-reset",
  "mainEntity": {
    "@type": "Action",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "https://alphavault.com/auth/password-reset"
    },
    "description": "Password recovery form for Alpha Vault financial platform"
  }
}
</script>
